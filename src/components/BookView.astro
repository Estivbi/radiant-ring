---
import type { Book } from '../data/books';

interface Props {
  book: Book;
}

const { book } = Astro.props as Props;
---

<section class="p-0 min-h-screen w-full">
  <div class="max-w-4xl mx-auto p-8 pb-12">
    <!-- Breadcrumb: volver al inicio -->
    <nav class="text-sm mb-4">
      <a href="/" class="text-black font-semibold hover:underline">Inicio</a>
      <span class="mx-2 text-gray-500">/</span>
      <span class="text-gray-700">{book.title}</span>
    </nav>

    <div class="flex flex-col md:flex-row gap-8 md:items-center">
  <div class="w-full md:w-1/3 flex items-center justify-center md:mt-0 min-h-[340px] md:min-h-[384px]">
        <img src={book.cover} alt={`Portada de ${book.title}`} class="w-auto h-[320px] md:h-96 rounded shadow object-contain" />
      </div>
      <div class="w-full md:w-2/3 text-gray-900">
        <h1 class="text-3xl font-bold mb-4">{book.title}</h1>
        <div class="mb-4">
          <div id={`desc-container-${book.id}`} class="text-justify whitespace-pre-line overflow-hidden transition-all duration-500" style="height:auto;">
            {(() => {
              const descLines = book.description.split('\n').filter(Boolean);
              const showLeerMas = descLines.length > 3;
              return (
                <>
                  <span id={`desc-short-${book.id}`}>{descLines.slice(0, 3).join(' ')}{showLeerMas ? '...' : ''}</span>
                  <span id={`desc-full-${book.id}`} class="hidden">{book.description}
                    <button
                      type="button"
                      class="ml-2 text-black underline text-sm"
                      onclick={`
                        const c=document.getElementById('desc-container-${book.id}');
                        const short=document.getElementById('desc-short-${book.id}');
                        const full=document.getElementById('desc-full-${book.id}');
                        const btn=document.getElementById('btn-leer-mas-${book.id}');
                        c.style.height=short.offsetHeight+'px';
                        setTimeout(()=>{
                          short.classList.remove('hidden');
                          full.classList.add('hidden');
                          btn.style.display='';
                          c.style.height=short.offsetHeight+'px';
                        },10);
                      `}
                    >Leer menos</button>
                  </span>
                  {showLeerMas && (
                    <button
                      id={`btn-leer-mas-${book.id}`}
                      type="button"
                      class="ml-2 text-black underline text-sm"
                      onclick={`
                        const c=document.getElementById('desc-container-${book.id}');
                        const short=document.getElementById('desc-short-${book.id}');
                        const full=document.getElementById('desc-full-${book.id}');
                        c.style.height=short.offsetHeight+'px';
                        short.classList.add('hidden');
                        full.classList.remove('hidden');
                        setTimeout(()=>{
                          c.style.height=full.offsetHeight+'px';
                        },10);
                        this.style.display='none';
                      `}
                    >Leer m√°s</button>
                  )}
                </>
              );
            })()}
          </div>
        </div>
  <p class="text-xl font-semibold mb-4">Precio: <span class="text-black">{book.price.toFixed(2)}&euro;</span></p>

        <div class="mb-6">
          <h2 class="text-xl font-semibold mb-2">Opciones de compra y contacto</h2>
          <div class="flex flex-col gap-3">
            {book.buyLink && (
              <a href={book.buyLink} target="_blank" rel="noopener noreferrer" class="px-4 py-2 font-bold rounded w-fit max-w-xs text-gray-900" style="background-color:#FF9900;" onmouseover="this.style.backgroundColor='#e48b00'" onmouseout="this.style.backgroundColor='#FF9900'">Comprar en Amazon</a>
            )}
            <p class="mt-2 font-semibold">Comprar a Custodio:</p>
            <div class="grid grid-cols-2 w-full max-w-xs">
              <a href={`mailto:toyirock@gmail.com?subject=${encodeURIComponent(`Quiero comprar el libro ${book.title}`)}`} target="_blank" rel="noopener noreferrer" class="px-4 py-2 bg-gray-800 text-white rounded transition-colors duration-200 hover:bg-gray-600 w-fit max-w-xs">Por Email</a>
              <a href="https://instagram.com/custodio.perezperez" target="_blank" rel="noopener noreferrer" class="px-4 py-2 bg-pink-600 text-white rounded transition-colors duration-200 hover:bg-pink-700 w-fit max-w-xs">Por Instagram</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
